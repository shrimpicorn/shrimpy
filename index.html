<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shrimpy</title>

<!-- ============================================================
     CSS
     ============================================================ -->
<style>
  @font-face {
    font-family: 'Magic Sound';
    src: url('Magic Sound.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    font-family: 'Magic Sound', cursive;
    user-select: none;
  }

  #shake-wrapper {
    position: fixed;
    inset: 0;
    overflow: hidden;
  }

  #game-container {
    position: relative;
    width: 100%;
    height: 100%;
    background-image: var(--bg-image);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }

  /* ‚îÄ‚îÄ HUD ‚îÄ‚îÄ */
  #hud {
    position: absolute;
    top: 16px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    z-index: 100;
    pointer-events: none;
  }

  #score-display {
    font-size: 2.4rem;
    font-weight: bold;
    color: #fff;
    text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000,
                 0 0 8px rgba(0,0,0,0.6);
    line-height: 1.1;
  }

  #missed-display {
    font-size: 1.3rem;
    font-weight: bold;
    color: #ffe94d;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    margin-top: 4px;
  }

  #level-display {
    font-size: 1.1rem;
    font-weight: bold;
    color: #aaffaa;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    margin-top: 2px;
  }

  #highscore-display {
    font-size: 1.05rem;
    font-weight: bold;
    color: #ffd700;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    margin-top: 2px;
  }

  #combo-display {
    display: none;
    font-size: 1.15rem;
    font-weight: bold;
    color: #ff9900;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    margin-top: 3px;
    transition: color 0.2s ease;
  }

  #combo-display.x2 { color: #ff8800; }
  #combo-display.x3 { color: #ff2200; }

  @keyframes comboGlow {
    0%   { text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000; }
    40%  { text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                        0 0 18px #ff8800, 0 0 34px #ff4400; }
    100% { text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000; }
  }

  #combo-display.glow { animation: comboGlow 0.55s ease-out; }

  /* ‚îÄ‚îÄ Storm overlay ‚îÄ‚îÄ */
  #storm-overlay {
    position: absolute;
    inset: 0;
    background: rgba(8, 0, 28, 0.28);
    opacity: 0;
    z-index: 90;
    pointer-events: none;
    transition: opacity 0.4s ease;
  }

  /* ‚îÄ‚îÄ Storm banner ‚îÄ‚îÄ */
  #storm-banner {
    position: absolute;
    top: 108px;
    left: 50%;
    transform: translateX(-50%) scale(0.75);
    z-index: 110;
    pointer-events: none;
    text-align: center;
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.3s ease;
    white-space: nowrap;
  }

  #storm-banner.visible {
    opacity: 1;
    transform: translateX(-50%) scale(1);
  }

  #storm-title {
    font-size: 2.6rem;
    font-weight: bold;
    color: #ff5500;
    text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000,
                 0 0 20px rgba(255,120,0,0.9);
    animation: stormGlow 0.45s infinite alternate;
  }

  @keyframes stormGlow {
    from { text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000,
                        0 0 10px rgba(255,80,0,0.6); }
    to   { text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000,
                        0 0 36px rgba(255,160,0,1); }
  }

  #storm-countdown {
    font-size: 1.6rem;
    font-weight: bold;
    color: #ffcc00;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    margin-top: 2px;
  }

  #storm-bar-wrap {
    margin: 6px auto 0;
    width: 160px;
    height: 9px;
    background: rgba(0,0,0,0.45);
    border-radius: 5px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.25);
  }

  #storm-bar {
    height: 100%;
    width: 100%;
    background: linear-gradient(90deg, #ff4400, #ffcc00);
    border-radius: 5px;
  }

  /* ‚îÄ‚îÄ Combo banner ‚îÄ‚îÄ */
  #combo-banner {
    position: absolute;
    top: 164px;
    left: 50%;
    z-index: 145;
    pointer-events: none;
    font-size: 2.4rem;
    font-weight: bold;
    white-space: nowrap;
    opacity: 0;
    transform: translateX(-50%) scale(0.7);
  }

  #combo-banner.show {
    animation: comboBannerAnim 1.9s ease-out forwards;
  }

  @keyframes comboBannerAnim {
    0%   { opacity: 0; transform: translateX(-50%) scale(0.7); }
    14%  { opacity: 1; transform: translateX(-50%) scale(1.12); }
    65%  { opacity: 1; transform: translateX(-50%) scale(1.0); }
    100% { opacity: 0; transform: translateX(-50%) translateY(-22px) scale(0.9); }
  }

  /* ‚îÄ‚îÄ Level-up flash ‚îÄ‚îÄ */
  #levelup-flash {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.6);
    font-size: 3.5rem;
    font-weight: bold;
    color: #ffe94d;
    text-shadow: -3px -3px 0 #000, 3px -3px 0 #000, -3px 3px 0 #000, 3px 3px 0 #000;
    z-index: 150;
    pointer-events: none;
    white-space: nowrap;
    opacity: 0;
  }

  #levelup-flash.show {
    display: block;
    animation: levelupAnim 1.4s ease-out forwards;
  }

  @keyframes levelupAnim {
    0%   { opacity: 0; transform: translate(-50%, -50%) scale(0.6); }
    20%  { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
    70%  { opacity: 1; transform: translate(-50%, -60%) scale(1.0); }
    100% { opacity: 0; transform: translate(-50%, -80%) scale(0.9); }
  }

  /* ‚îÄ‚îÄ Falling objects ‚îÄ‚îÄ */
  .falling-object {
    position: absolute;
    width: 108px;
    height: 108px;
    cursor: pointer;
    will-change: left, top;
    transition: transform 0.1s ease;
    filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.4));
    touch-action: none;
  }

  .falling-object img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    pointer-events: none;
    display: block;
  }

  .falling-object:hover { transform: scale(1.18); }

  /* ‚îÄ‚îÄ Golden shrimp ‚îÄ‚îÄ */
  .golden-shrimp {
    animation: goldenPulse 0.65s ease-in-out infinite alternate !important;
  }

  @keyframes goldenPulse {
    from { filter: drop-shadow(0 0 7px #ffd700) drop-shadow(0 0 14px #ffaa00); }
    to   { filter: drop-shadow(0 0 16px #fff200) drop-shadow(0 0 32px #ff8800); }
  }

  .golden-aura {
    position: absolute;
    inset: -10px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,215,0,0.28) 0%, transparent 68%);
    pointer-events: none;
    animation: auraPing 0.75s ease-in-out infinite;
  }

  @keyframes auraPing {
    0%   { transform: scale(0.82); opacity: 0.9; }
    50%  { transform: scale(1.22); opacity: 0.35; }
    100% { transform: scale(0.82); opacity: 0.9; }
  }

  /* ‚îÄ‚îÄ Flash overlays ‚îÄ‚îÄ */
  #flash-overlay {
    position: absolute;
    inset: 0;
    background: rgba(255, 0, 0, 0);
    z-index: 120;
    pointer-events: none;
    transition: background 0.06s ease;
  }

  /* ‚îÄ‚îÄ Particles ‚îÄ‚îÄ */
  #particles-container {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 130;
    overflow: hidden;
  }

  .particle {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    animation: particleBurst 0.72s ease-out forwards;
  }

  @keyframes particleBurst {
    0%   { opacity: 1; transform: translate(0, 0) scale(1); }
    100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0.15); }
  }

  /* ‚îÄ‚îÄ Floating score text ‚îÄ‚îÄ */
  .floating-text {
    position: absolute;
    font-family: 'Magic Sound', cursive;
    font-size: 1.9rem;
    font-weight: bold;
    color: #ffe94d;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    pointer-events: none;
    z-index: 140;
    animation: floatUp 0.82s ease-out forwards;
    white-space: nowrap;
  }

  .floating-text.golden {
    color: #ffd700;
    font-size: 2.3rem;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000,
                 0 0 12px #ffd700;
  }

  @keyframes floatUp {
    0%   { opacity: 1; transform: translateY(0) scale(1); }
    35%  { opacity: 1; transform: translateY(-28px) scale(1.25); }
    100% { opacity: 0; transform: translateY(-82px) scale(0.8); }
  }

  /* ‚îÄ‚îÄ Game Over screen ‚îÄ‚îÄ */
  #game-over-screen {
    display: none;
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.72);
    z-index: 200;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 18px;
  }

  #game-over-screen.visible { display: flex; }

  #game-over-title {
    font-size: 5rem;
    font-weight: bold;
    color: #ff3c3c;
    text-shadow: -3px -3px 0 #000, 3px -3px 0 #000, -3px 3px 0 #000, 3px 3px 0 #000,
                 0 0 20px rgba(255,0,0,0.5);
    letter-spacing: 4px;
    animation: pulse 0.8s infinite alternate;
  }

  @keyframes pulse {
    from { transform: scale(1); }
    to   { transform: scale(1.06); }
  }

  #final-score-label {
    font-size: 2rem;
    color: #fff;
    text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
  }

  #final-level-label {
    font-size: 1.4rem;
    color: #aaffaa;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
  }

  #final-highscore-label {
    font-size: 1.4rem;
    color: #ffd700;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
  }

  #new-highscore-banner {
    display: none;
    font-size: 2rem;
    font-weight: bold;
    color: #ffd700;
    text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000,
                 0 0 14px rgba(255,215,0,0.7);
    animation: pulse 0.6s infinite alternate;
  }

  #new-highscore-banner.visible { display: block; }

  /* ‚îÄ‚îÄ Speech cloud ‚îÄ‚îÄ */
  #speech-cloud {
    display: none;
    position: absolute;
    left: 220px;
    bottom: 55%;
    width: 230px;
    background: #fff;
    border: 3px solid #222;
    border-radius: 18px;
    padding: 14px 16px;
    text-align: center;
    box-shadow: 3px 4px 14px rgba(0,0,0,0.35);
    animation: cardPop 0.4s cubic-bezier(0.22,1,0.36,1) forwards;
    z-index: 211;
  }

  /* tail pointing left */
  #speech-cloud::before {
    content: '';
    position: absolute;
    left: -18px;
    bottom: 22px;
    border: 10px solid transparent;
    border-right-color: #222;
  }

  #speech-cloud::after {
    content: '';
    position: absolute;
    left: -13px;
    bottom: 24px;
    border: 8px solid transparent;
    border-right-color: #fff;
  }

  #speech-cloud.visible { display: block; }

  #speech-cloud p {
    font-size: 0.9rem;
    font-family: 'Magic Sound', cursive;
    color: #222;
    margin-bottom: 8px;
  }

  #agent-prompt-text {
    font-size: 0.78rem;
    color: #333;
    background: #f4f4f4;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 8px 10px;
    line-height: 1.55;
    text-align: left;
    white-space: pre-wrap;
    word-break: break-word;
    font-family: monospace;
    max-height: 110px;
    overflow-y: auto;
  }

  #copy-prompt-btn {
    margin-top: 9px;
    padding: 6px 20px;
    font-family: 'Magic Sound', cursive;
    font-size: 0.8rem;
    font-weight: bold;
    color: #000;
    background: #ffd700;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: transform 0.12s ease, background 0.15s ease;
  }

  #copy-prompt-btn:hover  { background: #ffe94d; transform: scale(1.06); }
  #copy-prompt-btn:active { transform: scale(0.97); }

  /* ‚îÄ‚îÄ Game Over guy ‚îÄ‚îÄ */
  #gameover-guy {
    display: none;
    position: absolute;
    bottom: 0;
    left: 0;
    width: 260px;
    z-index: 210;
    pointer-events: none;
    transform: translateX(-100%);
    transition: transform 0.5s cubic-bezier(0.22, 1, 0.36, 1);
    overflow: visible;
  }

  #gameover-guy.visible {
    display: block;
    transform: translateX(0%);
    pointer-events: auto;
  }

  #gameover-guy img {
    width: 100%;
    display: block;
  }

  .game-btn {
    margin-top: 10px;
    padding: 14px 48px;
    font-family: 'Magic Sound', cursive;
    font-size: 1.6rem;
    font-weight: bold;
    color: #fff;
    background: linear-gradient(145deg, #ff6a00, #ee0979);
    border: 3px solid #fff;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 6px 20px rgba(0,0,0,0.5);
    transition: transform 0.12s ease, box-shadow 0.12s ease;
  }

  .game-btn:hover { transform: scale(1.08); box-shadow: 0 10px 28px rgba(0,0,0,0.6); }
  .game-btn:active { transform: scale(0.97); }

  /* ‚îÄ‚îÄ Start screen ‚îÄ‚îÄ */
  #start-screen {
    position: absolute;
    inset: 0;
    z-index: 300;
    background-image: var(--start-bg);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
    transition: opacity 0.5s ease;
  }

  #start-screen.hidden { opacity: 0; pointer-events: none; }

  #start-title {
    font-size: 5rem;
    font-weight: bold;
    color: #fff;
    text-shadow: -3px -3px 0 #000, 3px -3px 0 #000, -3px 3px 0 #000, 3px 3px 0 #000,
                 0 0 24px rgba(0,180,255,0.7);
    letter-spacing: 3px;
    text-align: center;
    animation: titleFloat 2.4s ease-in-out infinite alternate;
  }

  @keyframes titleFloat {
    from { transform: translateY(0); }
    to   { transform: translateY(-10px); }
  }

  #start-subtitle {
    font-size: 1.2rem;
    color: #ff69b4;
    font-weight: bold;
    text-align: center;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    line-height: 1.8;
    max-width: 480px;
  }

  #start-highscore {
    font-size: 1.1rem;
    font-weight: bold;
    color: #ffd700;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
  }

  #start-btn {
    margin-top: 10px;
    padding: 18px 72px;
    font-family: 'Magic Sound', cursive;
    font-size: 2rem;
    font-weight: bold;
    color: #fff;
    background: linear-gradient(145deg, #00c6ff, #0072ff);
    border: 3px solid #fff;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 6px 28px rgba(0,114,255,0.6);
    transition: transform 0.12s ease;
    animation: btnPulse 1.2s ease-in-out infinite alternate;
  }

  @keyframes btnPulse {
    from { box-shadow: 0 6px 28px rgba(0,114,255,0.5); }
    to   { box-shadow: 0 8px 40px rgba(0,200,255,0.9); }
  }

  #start-btn:hover  { transform: scale(1.08); }
  #start-btn:active { transform: scale(0.97); }

  #follow-btn {
    position: absolute;
    bottom: 24px;
    right: 24px;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 28px;
    font-family: 'Magic Sound', cursive;
    font-size: 1rem;
    font-weight: bold;
    color: #fff;
    background: #000;
    border: 2px solid #fff;
    border-radius: 50px;
    text-decoration: none;
    white-space: nowrap;
    box-shadow: 0 4px 16px rgba(0,0,0,0.5);
    transition: transform 0.12s ease, background 0.2s ease;
  }

  #follow-btn:hover  { transform: scale(1.07); background: #1a1a1a; }
  #follow-btn:active { transform: scale(0.97); }

  /* ‚îÄ‚îÄ Mint tab button ‚îÄ‚îÄ */
  #mint-tab {
    position: fixed;
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    z-index: 400;
    writing-mode: vertical-rl;
    text-orientation: mixed;
    padding: 18px 10px;
    font-family: 'Magic Sound', cursive;
    font-size: 0.95rem;
    font-weight: bold;
    color: #fff;
    background: linear-gradient(180deg, #ff6a00, #ee0979);
    border: none;
    border-radius: 10px 0 0 10px;
    cursor: pointer;
    box-shadow: -3px 0 16px rgba(0,0,0,0.4);
    letter-spacing: 2px;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }

  #mint-tab:hover {
    transform: translateY(-50%) translateX(-4px);
    box-shadow: -6px 0 22px rgba(0,0,0,0.5);
  }

  /* ‚îÄ‚îÄ Mint popup overlay ‚îÄ‚îÄ */
  #mint-popup {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 500;
    background: rgba(0,0,0,0.65);
    align-items: center;
    justify-content: center;
  }

  #mint-popup.visible { display: flex; }

  #mint-card {
    position: relative;
    background: linear-gradient(145deg, #0d0d2b, #1a0a3a);
    border: 3px solid #ff6a00;
    border-radius: 20px;
    padding: 40px 48px 36px;
    text-align: center;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 0 40px rgba(255,106,0,0.4), 0 0 80px rgba(238,9,121,0.2);
    animation: cardPop 0.35s cubic-bezier(0.22,1,0.36,1) forwards;
  }

  @keyframes cardPop {
    from { transform: scale(0.8); opacity: 0; }
    to   { transform: scale(1);   opacity: 1; }
  }

  #mint-card h2 {
    font-size: 1.6rem;
    color: #ffd700;
    text-shadow: -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000,
                 0 0 20px rgba(255,215,0,0.6);
    margin-bottom: 20px;
    letter-spacing: 2px;
  }

  .mint-row {
    font-size: 1.15rem;
    color: #fff;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    margin: 10px 0;
    line-height: 1.5;
  }

  .mint-row span { color: #ffe94d; }

  .mint-highlight {
    margin-top: 18px;
    padding: 12px 16px;
    background: rgba(255,106,0,0.18);
    border: 2px solid #ff6a00;
    border-radius: 10px;
    font-size: 1.1rem;
    color: #ffcc88;
    text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
    line-height: 1.6;
  }

  #mint-close {
    position: absolute;
    top: 12px;
    right: 16px;
    background: none;
    border: none;
    color: #fff;
    font-size: 1.6rem;
    cursor: pointer;
    line-height: 1;
    opacity: 0.7;
    transition: opacity 0.15s ease;
    font-family: 'Magic Sound', cursive;
  }

  #mint-close:hover { opacity: 1; }
</style>
</head>

<!-- ============================================================
     HTML
     ============================================================ -->
<body>
<div id="shake-wrapper">
<div id="game-container">

  <!-- Start Screen -->
  <div id="start-screen">
    <div id="start-title">üç§ Shrimpy üç§</div>
    <div id="start-subtitle">
      Click the shrimp to score points!<br>
      Avoid the plastic trash.<br>
      Miss 3 shrimps and it's game over!
    </div>
    <div id="start-highscore">Best: 0</div>
    <button id="start-btn">&#9654; PLAY</button>
    <a id="follow-btn" href="https://x.com/Shrimp1corn" target="_blank" rel="noopener noreferrer">
      Follow us on ùïè
    </a>
  </div>

  <!-- HUD -->
  <div id="hud">
    <div id="score-display">Score: 0</div>
    <div id="missed-display">Missed: 0 / 3</div>
    <div id="level-display">Level 1</div>
    <div id="highscore-display">Best: 0</div>
    <div id="combo-display">Combo x1</div>
  </div>

  <!-- Storm -->
  <div id="storm-overlay"></div>
  <div id="storm-banner">
    <div id="storm-title">&#9889; STORM! &#9889;</div>
    <div id="storm-countdown">3</div>
    <div id="storm-bar-wrap"><div id="storm-bar"></div></div>
  </div>

  <!-- Combo banner -->
  <div id="combo-banner"></div>

  <!-- Level-up flash -->
  <div id="levelup-flash">LEVEL UP!</div>

  <!-- Flash overlay (red / gold) -->
  <div id="flash-overlay"></div>

  <!-- Particles -->
  <div id="particles-container"></div>

  <!-- Game Over Guy + speech cloud -->
  <div id="gameover-guy">
    <div id="speech-cloud">
      <p>Give this to your agent:</p>
      <div id="agent-prompt-text">AGENT TEXT PROMPT</div>
      <button id="copy-prompt-btn">üìã Copy</button>
    </div>
    <img src="" alt="guy">
  </div>

  <!-- Game Over Screen -->
  <div id="game-over-screen">
    <div id="game-over-title">GAME OVER</div>
    <div id="new-highscore-banner">&#11088; NEW HIGH SCORE! &#11088;</div>
    <div id="final-score-label">Final Score: <span id="final-score-value">0</span></div>
    <div id="final-level-label">Level reached: <span id="final-level-value">1</span></div>
    <div id="final-highscore-label">Best: <span id="final-highscore-value">0</span></div>
    <button class="game-btn" id="restart-btn">&#9654; Restart</button>
  </div>

</div>
</div>

<!-- Mint tab (always visible) -->
<button id="mint-tab">üç§ MINT INFO</button>

<!-- Mint popup -->
<div id="mint-popup">
  <div id="mint-card">
    <button id="mint-close">‚úï</button>
    <h2>üç§ Shrimpicorns</h2>
    <div class="mint-row">Supply: <span>4,269</span></div>
    <div class="mint-row">Team vault: <span>269</span></div>
    <div class="mint-row">MP: <span>0.69$ in ETH</span></div>
    <div class="mint-row">Buy <span>5</span> get <span>1 free!</span></div>
    <div class="mint-highlight">
      üèÜ Score more than <span style="color:#ffd700">10</span> to unlock<br>the <span style="color:#ffd700">Agent Prompt!</span>
    </div>
  </div>
</div>

<!-- ============================================================
     JAVASCRIPT
     ============================================================ -->
<script>
  /* ‚îÄ‚îÄ Image paths ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  const backgroundImage   = "background.png";
  const startImage        = "startscreen.png";
  const shrimpImage       = "shrimp.png";
  const goldenShrimpImage = "shrimp_golden.png";  // golden variant
  const badImages         = ["plastic1.png", "plastic2.png", "plastic3.png", "plastic4.png", "plastic5.png"];
  const guyImage          = "gameoverguy.png";

  /* ‚îÄ‚îÄ Apply backgrounds ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  document.getElementById("game-container").style.setProperty("--bg-image", `url("${backgroundImage}")`);
  document.getElementById("start-screen").style.setProperty("--start-bg",   `url("${startImage}")`);

  /* ‚îÄ‚îÄ DOM refs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  const shakeWrapper        = document.getElementById("shake-wrapper");
  const gameContainer       = document.getElementById("game-container");
  const startScreen         = document.getElementById("start-screen");
  const startBtn            = document.getElementById("start-btn");
  const startHighscoreEl    = document.getElementById("start-highscore");
  const scoreDisplay        = document.getElementById("score-display");
  const missedDisplay       = document.getElementById("missed-display");
  const levelDisplay        = document.getElementById("level-display");
  const highscoreDisplay    = document.getElementById("highscore-display");
  const comboDisplay        = document.getElementById("combo-display");
  const stormOverlay        = document.getElementById("storm-overlay");
  const stormBanner         = document.getElementById("storm-banner");
  const stormCountdownEl    = document.getElementById("storm-countdown");
  const stormBar            = document.getElementById("storm-bar");
  const comboBanner         = document.getElementById("combo-banner");
  const levelupFlash        = document.getElementById("levelup-flash");
  const flashOverlay        = document.getElementById("flash-overlay");
  const particlesContainer  = document.getElementById("particles-container");
  const gameOverScreen      = document.getElementById("game-over-screen");
  const finalScoreValue     = document.getElementById("final-score-value");
  const finalLevelValue     = document.getElementById("final-level-value");
  const finalHighscoreValue = document.getElementById("final-highscore-value");
  const newHighscoreBanner  = document.getElementById("new-highscore-banner");
  const speechCloud         = document.getElementById("speech-cloud");
  const copyPromptBtn       = document.getElementById("copy-prompt-btn");
  const gameoverGuy         = document.getElementById("gameover-guy");

  copyPromptBtn.addEventListener("click", () => {
    navigator.clipboard.writeText(document.getElementById("agent-prompt-text").textContent)
      .then(() => { copyPromptBtn.textContent = "‚úÖ Copied!"; setTimeout(() => { copyPromptBtn.textContent = "üìã Copy"; }, 1800); })
      .catch(() => {});
  });
  const restartBtn          = document.getElementById("restart-btn");

  /* ‚îÄ‚îÄ Set guy image ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  gameoverGuy.querySelector("img").src = guyImage;

  /* ‚îÄ‚îÄ Persistent high score ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  let highScore = parseInt(localStorage.getItem("shrimpyHighScore") || "0", 10);
  startHighscoreEl.textContent = `Best: ${highScore}`;

  /* ‚îÄ‚îÄ Game state ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  let score            = 0;
  let missed           = 0;
  let level            = 1;
  let isGameOver       = false;
  let isStorm          = false;
  let objects          = [];
  let spawnTimer       = null;
  let shrimpTimer      = null;
  let stormTimeout     = null;
  let stormCdTimer     = null;
  let rafId            = null;
  let lastTime         = null;
  let parallaxOffset   = 0;
  let parallaxDir      = 1;
  let nextStormAt      = 20;

  /* ‚îÄ‚îÄ Slow-motion state ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  let timeScale      = 1.0;
  let slowMoTimer    = null;
  let slowMoRaf      = null;

  /* ‚îÄ‚îÄ Combo state ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  let comboTimestamps  = [];
  let multiplier       = 1;
  let comboBannerTimer = null;

  /* ‚îÄ‚îÄ Constants ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  const MAX_MISSED     = 3;
  const STORM_DURATION = 3000;
  const OBJ_SIZE       = 108;
  const PARALLAX_SPD   = 6;
  const PARALLAX_MAX   = 18;
  const GOLDEN_CHANCE  = 0.05;   // 5 % of shrimp spawns
  const GOLDEN_LEVEL   = 5;      // advanced mechanics unlock
  const COMBO_WINDOW   = 2000;   // ms

  /* ‚îÄ‚îÄ Math helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  const clamp   = (v, lo, hi) => Math.max(lo, Math.min(hi, v));
  const lerp    = (a, b, t)   => a + (b - a) * t;
  const easeOut = t => 1 - (1 - t) * (1 - t);
  const easeIn  = t => t * t;
  const rand    = (lo, hi) => Math.random() * (hi - lo) + lo;
  const randInt = (lo, hi) => Math.floor(rand(lo, hi + 1));

  /* ‚îÄ‚îÄ Level from score (score-based, every 10 pts) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function computeLevel() { return Math.floor(score / 10) + 1; }

  /* ‚îÄ‚îÄ Progressive difficulty curves ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function getSpawnMin() {
    const t = easeOut(clamp(score / 80, 0, 1));
    const base = Math.max(380, lerp(900, 500, t));
    return isStorm ? 140 : base * 0.85;
  }
  function getSpawnMax() {
    const t = easeOut(clamp(score / 80, 0, 1));
    const base = Math.max(500, lerp(1200, 680, t));
    return isStorm ? 260 : base;
  }
  function getSpeedMin() {
    const t = easeOut(clamp(score / 80, 0, 1));
    const base = lerp(190, 320, t);
    return isStorm ? base * 1.55 : base;
  }
  function getSpeedMax() {
    const t = easeOut(clamp(score / 80, 0, 1));
    const base = Math.min(520, lerp(340, 500, t));
    return isStorm ? Math.min(720, base * 1.65) : base;
  }
  function getPlasticProb() {
    const t = easeIn(clamp(score / 100, 0, 1));
    return isStorm ? 0.88 : lerp(0.72, 0.84, t);
  }

  /* ‚îÄ‚îÄ HUD update ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function updateHUD() {
    scoreDisplay.textContent     = `Score: ${score}`;
    missedDisplay.textContent    = `Missed: ${missed} / ${MAX_MISSED}`;
    levelDisplay.textContent     = `Level ${level}`;
    highscoreDisplay.textContent = `Best: ${highScore}`;

    if (level >= GOLDEN_LEVEL) {
      comboDisplay.style.display = "block";
      comboDisplay.textContent   = `Combo x${multiplier}`;
      comboDisplay.className     = multiplier === 3 ? "x3" : multiplier === 2 ? "x2" : "";
    } else {
      comboDisplay.style.display = "none";
    }
  }

  /* ‚îÄ‚îÄ Level update (score-based) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function updateLevel() {
    const newLevel = computeLevel();
    if (newLevel !== level) {
      level = newLevel;
      levelupFlash.classList.remove("show");
      void levelupFlash.offsetWidth;
      levelupFlash.classList.add("show");
      setTimeout(() => levelupFlash.classList.remove("show"), 1500);
    }
  }

  /* ‚îÄ‚îÄ WebAudio: storm ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function playStormSound() {
    try {
      const ctx  = new (window.AudioContext || window.webkitAudioContext)();
      const o1   = ctx.createOscillator();
      const o2   = ctx.createOscillator();
      const gain = ctx.createGain();
      o1.type = "sawtooth"; o2.type = "sine";
      o1.frequency.setValueAtTime(55,  ctx.currentTime);
      o1.frequency.linearRampToValueAtTime(220, ctx.currentTime + 0.45);
      o2.frequency.setValueAtTime(110, ctx.currentTime);
      o2.frequency.linearRampToValueAtTime(440, ctx.currentTime + 0.45);
      gain.gain.setValueAtTime(0,    ctx.currentTime);
      gain.gain.linearRampToValueAtTime(0.22, ctx.currentTime + 0.14);
      gain.gain.linearRampToValueAtTime(0,    ctx.currentTime + 0.75);
      o1.connect(gain); o2.connect(gain); gain.connect(ctx.destination);
      o1.start(); o2.start();
      o1.stop(ctx.currentTime + 0.75); o2.stop(ctx.currentTime + 0.75);
    } catch (_) {}
  }

  /* ‚îÄ‚îÄ WebAudio: golden shrimp ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function playGoldenSound() {
    try {
      const ctx  = new (window.AudioContext || window.webkitAudioContext)();
      const osc  = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = "sine";
      osc.frequency.setValueAtTime(880,  ctx.currentTime);
      osc.frequency.linearRampToValueAtTime(1320, ctx.currentTime + 0.12);
      osc.frequency.linearRampToValueAtTime(1760, ctx.currentTime + 0.26);
      gain.gain.setValueAtTime(0.18, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
      osc.connect(gain); gain.connect(ctx.destination);
      osc.start(); osc.stop(ctx.currentTime + 0.5);
    } catch (_) {}
  }

  /* ‚îÄ‚îÄ Slow-motion ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function triggerSlowMo(duration) {
    if (isGameOver) return;
    clearTimeout(slowMoTimer);
    if (slowMoRaf) { cancelAnimationFrame(slowMoRaf); slowMoRaf = null; }
    timeScale = 0.55;
    const rampMs   = 280;
    const holdMs   = Math.max(0, duration - rampMs);
    slowMoTimer = setTimeout(() => {
      const start   = performance.now();
      const fromTs  = timeScale;
      function ramp(ts) {
        if (isGameOver) { timeScale = 1.0; slowMoRaf = null; return; }
        const t = Math.min((ts - start) / rampMs, 1);
        timeScale = lerp(fromTs, 1.0, easeOut(t));
        if (t < 1) slowMoRaf = requestAnimationFrame(ramp);
        else { timeScale = 1.0; slowMoRaf = null; }
      }
      slowMoRaf = requestAnimationFrame(ramp);
    }, holdMs);
  }

  /* ‚îÄ‚îÄ Screen shake ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function screenShake(intensity, duration) {
    let start = null;
    (function tick(ts) {
      if (!start) start = ts;
      const e = ts - start;
      if (e < duration) {
        const amp = intensity * (1 - e / duration);
        shakeWrapper.style.transform =
          `translate(${(Math.random()-0.5)*2*amp}px,${(Math.random()-0.5)*2*amp}px)`;
        requestAnimationFrame(tick);
      } else { shakeWrapper.style.transform = ""; }
    })(performance.now());
  }

  /* ‚îÄ‚îÄ Flash overlays ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function redFlash() {
    flashOverlay.style.background = "rgba(255,0,0,0.38)";
    setTimeout(() => { flashOverlay.style.background = "rgba(255,0,0,0)"; }, 180);
  }
  function goldFlash() {
    flashOverlay.style.background = "rgba(255,215,0,0.22)";
    setTimeout(() => { flashOverlay.style.background = "rgba(255,0,0,0)"; }, 220);
  }

  /* ‚îÄ‚îÄ Particle colours ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  const P_COLORS = {
    shrimp:  ["#55ddff","#44bbff","#99eeff","#aaffee","#ffffff"],
    golden:  ["#ffd700","#ffee44","#fff700","#ffaa00","#ffe680"],
    plastic: ["#44ff88","#88ff00","#ccff00","#ffee00","#00ffcc"],
    missed:  ["#aa88ff","#8866cc","#ccbbff","#ffffff"],
  };

  function spawnParticles(x, y, type) {
    const colors = P_COLORS[type] || P_COLORS.shrimp;
    for (let i = 0; i < 10; i++) {
      const p     = document.createElement("div");
      p.className = "particle";
      const angle = (i / 10) * Math.PI * 2 + rand(-0.35, 0.35);
      const dist  = rand(28, 68);
      const size  = rand(5, 12);
      p.style.cssText = [
        `left:${x}px`, `top:${y}px`,
        `width:${size}px`, `height:${size}px`,
        `margin-left:${-size/2}px`, `margin-top:${-size/2}px`,
        `background:${colors[randInt(0, colors.length-1)]}`,
        `--dx:${Math.cos(angle)*dist}px`,
        `--dy:${Math.sin(angle)*dist}px`,
      ].join(";");
      particlesContainer.appendChild(p);
      setTimeout(() => p.remove(), 760);
    }
  }

  /* ‚îÄ‚îÄ Floating score text ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function spawnFloatingText(x, y, text, isGold) {
    const el     = document.createElement("div");
    el.className = isGold ? "floating-text golden" : "floating-text";
    el.textContent = text;
    el.style.left  = (x - 16) + "px";
    el.style.top   = (y - 16) + "px";
    gameContainer.appendChild(el);
    setTimeout(() => el.remove(), 870);
  }

  /* ‚îÄ‚îÄ Combo system ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function updateCombo() {
    if (level < GOLDEN_LEVEL) return;
    const now = Date.now();
    comboTimestamps.push(now);
    comboTimestamps = comboTimestamps.filter(t => now - t <= COMBO_WINDOW);
    const prev = multiplier;
    multiplier = comboTimestamps.length >= 6 ? 3
               : comboTimestamps.length >= 3 ? 2 : 1;
    if (multiplier > prev) {
      showComboBanner(multiplier);
      triggerComboGlow();
      if (multiplier === 3) goldFlash();
    }
  }

  function resetCombo() {
    comboTimestamps = [];
    multiplier = 1;
    updateHUD();
  }

  function triggerComboGlow() {
    comboDisplay.classList.remove("glow");
    void comboDisplay.offsetWidth;
    comboDisplay.classList.add("glow");
    setTimeout(() => comboDisplay.classList.remove("glow"), 560);
  }

  function showComboBanner(mult) {
    if (mult === 3) {
      comboBanner.textContent  = "üî• DEGEN SPEED";
      comboBanner.style.color  = "#ff2200";
      comboBanner.style.textShadow =
        "-2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000, 0 0 24px #ff4400";
    } else {
      comboBanner.textContent  = "‚ö° COMBO x2";
      comboBanner.style.color  = "#ff9900";
      comboBanner.style.textShadow =
        "-2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000, 0 0 18px #ff8800";
    }
    comboBanner.classList.remove("show");
    void comboBanner.offsetWidth;
    comboBanner.classList.add("show");
    clearTimeout(comboBannerTimer);
    comboBannerTimer = setTimeout(() => comboBanner.classList.remove("show"), 1900);
  }

  /* ‚îÄ‚îÄ Storm ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function triggerStorm() {
    if (isGameOver || isStorm) return;
    isStorm = true;
    clearTimeout(spawnTimer);
    scheduleSpawn();
    stormOverlay.style.opacity = "1";
    stormBanner.classList.add("visible");
    stormBar.style.transition = "none";
    stormBar.style.width = "100%";
    requestAnimationFrame(() => requestAnimationFrame(() => {
      stormBar.style.transition = `width ${STORM_DURATION}ms linear`;
      stormBar.style.width = "0%";
    }));
    let cd = 3;
    stormCountdownEl.textContent = cd;
    clearInterval(stormCdTimer);
    stormCdTimer = setInterval(() => {
      cd--;
      stormCountdownEl.textContent = Math.max(0, cd);
      if (cd <= 0) clearInterval(stormCdTimer);
    }, 1000);
    playStormSound();
    screenShake(5, 360);
    clearTimeout(stormTimeout);
    stormTimeout = setTimeout(endStorm, STORM_DURATION);
  }

  function endStorm() {
    isStorm = false;
    clearInterval(stormCdTimer);
    stormOverlay.style.opacity = "0";
    stormBanner.classList.remove("visible");
    stormBar.style.transition = "none";
    stormBar.style.width = "100%";
    clearTimeout(spawnTimer);
    scheduleSpawn();
  }

  function checkStorm() {
    if (score >= nextStormAt && !isStorm) {
      nextStormAt += 20;
      triggerStorm();
    }
  }

  /* ‚îÄ‚îÄ Spawn one falling object ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function spawnObject() {
    if (isGameOver) return;

    const isPlastic = Math.random() < getPlasticProb();
    let type     = isPlastic ? "bad" : "shrimp";
    let isGolden = false;

    // Golden shrimp: 5 % of shrimp spawns, only from Level 6+
    if (!isPlastic && level >= GOLDEN_LEVEL && Math.random() < GOLDEN_CHANCE) {
      isGolden = true;
    }

    const desc = {
      type,
      isGolden,
      src:           isGolden ? goldenShrimpImage
                   : type === "shrimp" ? shrimpImage
                   : badImages[randInt(0, badImages.length - 1)],
      baseX:         rand(OBJ_SIZE * 0.4, window.innerWidth - OBJ_SIZE * 1.4),
      x:             0,
      y:             -OBJ_SIZE,
      speed:         rand(getSpeedMin(), getSpeedMax()),
      waveAngle:     rand(0, Math.PI * 2),
      waveSpeed:     isStorm ? rand(2.5, 4.0) : rand(1.1, 2.2),
      waveAmplitude: isStorm ? rand(40, 65)   : rand(16, 30),
      clicked:       false,
      el:            null,
    };
    desc.x = desc.baseX;

    const el = document.createElement("div");
    el.className    = "falling-object";
    el.style.left   = desc.x + "px";
    el.style.top    = desc.y + "px";
    el.dataset.type = type;

    if (isGolden) {
      el.classList.add("golden-shrimp");
      const aura = document.createElement("div");
      aura.className = "golden-aura";
      el.appendChild(aura);
    }

    const img = document.createElement("img");
    img.src = desc.src;
    img.alt = type;
    el.appendChild(img);
    el.addEventListener("click", (e) => handleClick(desc, e));

    gameContainer.appendChild(el);
    desc.el = el;
    objects.push(desc);

    // Golden spawn effects
    if (isGolden) {
      playGoldenSound();
      triggerSlowMo(rand(600, 900));
    }
  }

  /* ‚îÄ‚îÄ Handle click ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function handleClick(desc, e) {
    if (isGameOver || desc.clicked) return;
    desc.clicked = true;

    const cx = e ? e.clientX : desc.x + OBJ_SIZE / 2;
    const cy = e ? e.clientY : desc.y + OBJ_SIZE / 2;

    if (desc.type === "shrimp") {
      updateCombo();  // update multiplier for this click

      const base   = desc.isGolden ? 5 : 1;
      const points = base * multiplier;
      score += points;

      spawnParticles(cx, cy, desc.isGolden ? "golden" : "shrimp");
      spawnFloatingText(cx, cy, `+${points}`, desc.isGolden);

      if (desc.isGolden) playGoldenSound();

      updateLevel();
      checkStorm();
      updateHUD();
      removeObject(desc);
    } else {
      spawnParticles(cx, cy, "plastic");
      redFlash();
      screenShake(5, 300);
      triggerGameOver();
    }
  }

  /* ‚îÄ‚îÄ Remove object ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function removeObject(desc) {
    if (desc.el && desc.el.parentNode) desc.el.parentNode.removeChild(desc.el);
    desc.el = null;
    const idx = objects.indexOf(desc);
    if (idx !== -1) objects.splice(idx, 1);
  }

  /* ‚îÄ‚îÄ Game Over ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function triggerGameOver() {
    if (isGameOver) return;
    isGameOver = true;

    clearTimeout(spawnTimer);
    clearTimeout(shrimpTimer);
    clearTimeout(stormTimeout);
    clearTimeout(slowMoTimer);
    clearTimeout(comboBannerTimer);
    clearInterval(stormCdTimer);
    if (slowMoRaf) { cancelAnimationFrame(slowMoRaf); slowMoRaf = null; }
    cancelAnimationFrame(rafId);

    endStorm();
    screenShake(6, 420);

    [...objects].forEach(removeObject);
    objects = [];

    const isNewRecord = score > highScore;
    if (isNewRecord) {
      highScore = score;
      localStorage.setItem("shrimpyHighScore", highScore);
    }

    finalScoreValue.textContent     = score;
    finalLevelValue.textContent     = level;
    finalHighscoreValue.textContent = highScore;
    newHighscoreBanner.classList.toggle("visible", isNewRecord);
    speechCloud.classList.toggle("visible", score > 10);
    updateHUD();
    gameOverScreen.classList.add("visible");
    // Slide guy in after a short delay
    gameoverGuy.style.display = "block";
    requestAnimationFrame(() => requestAnimationFrame(() => {
      gameoverGuy.classList.add("visible");
    }));
  }

  /* ‚îÄ‚îÄ Main RAF game loop ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function gameLoop(timestamp) {
    if (isGameOver) return;
    if (!lastTime) lastTime = timestamp;
    const delta   = Math.min((timestamp - lastTime) / 1000, 0.05);
    lastTime      = timestamp;
    const screenH = window.innerHeight;

    // Parallax background drift
    parallaxOffset += PARALLAX_SPD * delta * parallaxDir;
    if (Math.abs(parallaxOffset) >= PARALLAX_MAX) parallaxDir *= -1;
    gameContainer.style.backgroundPosition =
      `calc(50% + ${parallaxOffset.toFixed(2)}px) center`;

    // Move falling objects ‚Äî timeScale applied for slow-mo
    for (let i = objects.length - 1; i >= 0; i--) {
      const desc = objects[i];
      if (!desc.el) continue;

      desc.y         += desc.speed * delta * timeScale;
      desc.waveAngle += desc.waveSpeed * delta * timeScale;
      desc.x          = desc.baseX + Math.sin(desc.waveAngle) * desc.waveAmplitude;
      desc.el.style.top  = desc.y + "px";
      desc.el.style.left = desc.x + "px";

      if (desc.y > screenH) {
        if (desc.type === "shrimp" && !desc.clicked) {
          spawnParticles(
            clamp(desc.x + OBJ_SIZE / 2, 0, window.innerWidth),
            screenH - 8,
            "missed"
          );
          resetCombo();  // miss resets combo
          missed++;
          updateHUD();
          if (missed >= MAX_MISSED) {
            removeObject(desc);
            triggerGameOver();
            return;
          }
        }
        removeObject(desc);
      }
    }

    rafId = requestAnimationFrame(gameLoop);
  }

  /* ‚îÄ‚îÄ Spawn scheduler (timeScale slows interval during slow-mo) */
  function scheduleSpawn() {
    if (isGameOver) return;
    spawnObject();
    const interval = rand(getSpawnMin(), getSpawnMax()) / timeScale;
    spawnTimer = setTimeout(scheduleSpawn, interval);
  }

  /* ‚îÄ‚îÄ Guaranteed shrimp every 5 seconds ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function scheduleGuaranteedShrimp() {
    if (isGameOver) return;
    // Force spawn a shrimp directly (bypasses probability roll)
    spawnGuaranteedShrimp();
    shrimpTimer = setTimeout(scheduleGuaranteedShrimp, 5000);
  }

  function spawnGuaranteedShrimp() {
    if (isGameOver) return;
    const isGolden = level >= GOLDEN_LEVEL && Math.random() < GOLDEN_CHANCE;
    const desc = {
      type:          "shrimp",
      isGolden,
      src:           isGolden ? goldenShrimpImage : shrimpImage,
      baseX:         rand(OBJ_SIZE * 0.4, window.innerWidth - OBJ_SIZE * 1.4),
      x:             0,
      y:             -OBJ_SIZE,
      speed:         rand(getSpeedMin(), getSpeedMax()),
      waveAngle:     rand(0, Math.PI * 2),
      waveSpeed:     rand(1.1, 2.2),
      waveAmplitude: rand(16, 30),
      clicked:       false,
      el:            null,
    };
    desc.x = desc.baseX;
    const el = document.createElement("div");
    el.className    = "falling-object";
    el.style.left   = desc.x + "px";
    el.style.top    = desc.y + "px";
    el.dataset.type = "shrimp";
    if (isGolden) {
      el.classList.add("golden-shrimp");
      const aura = document.createElement("div");
      aura.className = "golden-aura";
      el.appendChild(aura);
    }
    const img = document.createElement("img");
    img.src = desc.src;
    img.alt = "shrimp";
    el.appendChild(img);
    el.addEventListener("click", (e) => handleClick(desc, e));
    gameContainer.appendChild(el);
    desc.el = el;
    objects.push(desc);
    if (isGolden) { playGoldenSound(); triggerSlowMo(rand(600, 900)); }
  }

  /* ‚îÄ‚îÄ Start / Restart ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function startGame() {
    score          = 0;
    missed         = 0;
    level          = 1;
    isGameOver     = false;
    isStorm        = false;
    lastTime       = null;
    objects        = [];
    parallaxOffset = 0;
    parallaxDir    = 1;
    nextStormAt    = 20;
    timeScale      = 1.0;
    comboTimestamps = [];
    multiplier     = 1;

    updateHUD();
    levelupFlash.classList.remove("show");
    comboBanner.classList.remove("show");
    newHighscoreBanner.classList.remove("visible");
    gameOverScreen.classList.remove("visible");
    speechCloud.classList.remove("visible");
    gameoverGuy.classList.remove("visible");
    gameoverGuy.style.display = "none";
    stormOverlay.style.opacity     = "0";
    stormBanner.classList.remove("visible");
    flashOverlay.style.background  = "rgba(255,0,0,0)";
    shakeWrapper.style.transform   = "";
    gameContainer.style.backgroundPosition = "center";

    document.querySelectorAll(".falling-object").forEach(el => el.remove());
    document.querySelectorAll(".particle").forEach(el => el.remove());
    document.querySelectorAll(".floating-text").forEach(el => el.remove());

    scheduleSpawn();
    scheduleGuaranteedShrimp();
    rafId = requestAnimationFrame(gameLoop);
  }

  /* ‚îÄ‚îÄ Dismiss start screen ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function dismissStartScreen() {
    startScreen.classList.add("hidden");
    setTimeout(() => { startScreen.style.display = "none"; }, 500);
    startGame();
  }

  /* ‚îÄ‚îÄ Button listeners ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  startBtn.addEventListener("click",   dismissStartScreen);
  restartBtn.addEventListener("click", startGame);

  /* ‚îÄ‚îÄ Mint popup ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  const mintTab   = document.getElementById("mint-tab");
  const mintPopup = document.getElementById("mint-popup");
  const mintClose = document.getElementById("mint-close");

  mintTab.addEventListener("click", () => mintPopup.classList.add("visible"));
  mintClose.addEventListener("click", () => mintPopup.classList.remove("visible"));
  mintPopup.addEventListener("click", (e) => {
    if (e.target === mintPopup) mintPopup.classList.remove("visible");
  });
</script>
</body>
</html>
